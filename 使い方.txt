■はじめに, Introduction
　・ダウンロードして頂き、ありがとうございます。
　・本ファイルは本プログラムのシステム要件、使い方、注意点などを記載しています。
　・ご使用の前にご一読ください。


■ファイル説明, File Description
  main.py 		  → 変換プログラム
  start.bat 		  → プログラムを実行するためのもの(Pathが通っていることが前提)
  OmniMIDI Settings.reg   → 私がOmniMIDIで使っている設定のファイル。
  Sine Wave Soundfont.sf2 → 主にOmniMIDIなどで使うサウンドフォント。標準のMIDIの音を正弦波に変えてくれる。
  使い方.txt 		  → 今見ているテキストファイル。
  README.md 		  → Githubでの説明用。


■概要, Outline
　・このツールは任意のWAVファイルにフーリエ変換を利用して、なるべく元のファイルと同じ聞こえ方をするようなMIDIへと変換するものです。
　・ある程度の知識があればプログラムをいじって自分好みにカスタマイズできますが、綺麗とは言えないコードになのでご注意を。


■システム要件, System requirement
　OS： Windows10 ~ Windows11
　RAM: 16GB以上。元が5分程度の曲で4GBぐらい使う。


■アンインストール, How to uninstall
　・このファイルのあるフォルダごとゴミ箱に捨てる。
　・必要に応じてインストールしたライブラリをアンインストール。 -> pip uninstall numpy scipy mido tqdm


■前提ソフト, Required Software
  ・Audacity   3.4.2  - 3.7.1
  ・Python     3.10.6 - 3.12.6
  ・OmniMIDI   14.8.5 (正弦波が合成できれば何でも)
  ・MIDI再生ソフト (私が使っているのはTom's MIDI Player)


■前提ライブラリ, Required Library
  numpy, scipy, mido, tqdm をコマンドプロンプトなどを使ってインストールする。
  -> pip install numpy scipy mido tqdm

  ・numpy   1.26.4 - 2.1.3
  ・scipy   1.12.0 - 1.15.1
  ・mido    1.3.2
  ・tqdm    4.66.5 - 4.67.1


■変換方法, How to convert
　以下の手順を実行してください。
  1. Audacityを起動し、MIDIにしたい音声ファイルをドラッグアンドドロップしたあと、音声トラックの左下辺りの何もないところをクリックして音声トラックが選択された状態にする。
  2. 上のタブから 「トラック>ミックス>ステレオをモノラルにミックスダウン」 の順に操作(元からモノラルの場合はこの手順は無視する)
  3. 「エフェクト>ピッチとテンポ>テンポを変更」 から、下の "高品質なストレッチを使用" にチェックを入れて、変更率を "-93.750" にする。
  4. 「エフェクト>音量と圧縮>増幅」 をクリックし、そのまま適用をクリックする。
　5. 「ファイル>オーディオをエクスポート」 をクリックし、形式は "WAV (Microsoft)" 、サンプリング周波数は元のまま、エンコーディングは "Signed 16-bit PCM" にして、コンピュータに問題が発生しない場所に好きな名前で書き出す(エクスポート)
　6．このテキストファイルがあるフォルダに "start.bat" という名前のバッチファイルがあるので起動し、新しく出てきたウィンドウから先ほど書き出したファイルを見つけてダブルクリックする。
　7．処理が終わるまで気長に待つ。
　8．しばらくすると、5番で書き出した時の名前のMIDIファイルが生成され、さらにコマンドプロンプトが閉じる(処理が終わる)のを待つと再生できるようになる。
  9．Tom's MIDI Playerなどを使って聴く。


■重要なポイント, Important point
  ・3番はサンプリング周波数が高いと時間がかかるときがあるため、44100Hzや48000Hzなどの一般的なサンプリング周波数に落としてから行っても問題ない。
  ・3番の変更率の-93.750とは1/16倍のことであり、この操作はフーリエ変換の周波数分解能を高めるために行う。
  ・4番はMIDIでの音量を適切にするために必要。
  ・5番のときに、エンコーディングを16bit以外にすると変換できないため気をつける。
  ・7番のときに、RAMがシステムの限界に近づきすぎるとパソコンがおかしくなる可能性があるため、残り2~4GBぐらいになってしまったら強制終了させる。

　・1/16倍速された音声データを対象としているため、上記の2番の手順を行わないとMIDIの再生速度が16倍になる。
  ・音量の目安は、Audacityで「解析>Measure RMS」の"Mono:"の値が、-18dB~-14dBの範囲に収まっていれば問題ない。
  ・お好みでEQフィルターなどを使って事前に聴こえ方を調整しても問題ない。
　・MIDIの再生にはOmniMIDIやシンセサイザー等を利用して、正弦波でMIDIデータを合成して聴く。
   (なお、環境によって同じMIDIデータでも聴こえ方が変わる)


■音質を上げたい場合, When sound quality is a priority
  1. プログラムの43行目の「sqrt_volume = sqrt(max_volume) * 0.55」を「max_volume = sqrt(max_volume) * 0.6」に置き換える。
　2. プログラムの18行目の「min_vol = 6」を「min_vol = 4」に置き換える。
  3. プログラムの19行目の「min_vol_2 = min_vol * 2」を「min_vol_2 = min_vol」に置き換える。
  4. プログラムの57行目の「sim = 4」を「sim = 2」に置き換える。

  ※2番は2よりも小さいと逆に音が悪くなります。
  ※3番は余裕があるなら「min_vol_2 = min_vol * 0.5」のように1未満にしても良いですし、「min_vol_2 = 0」としても良いです。
  ※個人的に効果が大きいと感じた順に並べています。また、これら操作により再生時の計算量が大幅に増加し、再生不良や音飛びが発生することがあります。


■軽量化したい場合, When performance is a priority
  1. プログラムの43行目の「sqrt_volume = sqrt(max_volume) * 0.55」を「max_volume = sqrt(max_volume) * 0.5」に置き換える。
　2. プログラムの18行目の「min_vol = 6」を「min_vol = 8」に置き換える。
　3. プログラムの19行目の「min_vol_2 = min_vol * 2」を「min_vol_2 = min_vol * 4」に置き換える。
  4. プログラムの57行目の「sim = 4」を「sim = 6」に置き換える。

  ※お好みで値は調整しても問題ありません。
  ※個人的に効果が大きいと感じた順に並べています。また、これら操作により音量が小さくなったり音質が低下します。


■最後に, Finally
　・ここに載っている環境やバージョンについては私が確認したものだけしか載せていません。
　・このテキストファイルの内容について変更を加えることがあります。
　・本プログラムは完全無料です。改変は許可しますが、再配布を禁じます。
　・本プログラムを使用したことによる損害について私は責任を負わないものとしますが、私の故意または重過失による損害についてはこの限りではありません。


編集:Bistanium
最終編集日:2025/02/08
